# Test Environment Configuration
#
# This file configures the test environment for both real hardware and simulated testing
# of security and Neuralink integration tests. It defines:
#   - Settings for both physical hardware and simulation environments
#   - Mock device configurations when real hardware isn't available
#   - Test harness settings for both scenarios
#   - Auto-fail conditions and security enforcement parameters
#
# SECURITY NOTICE: Modifications to this file require security team approval, as it
# directly impacts the enforcement of critical security requirements.

# Global Test Settings
global_settings:
  # Run directory for all tests (relative to project root)
  test_run_directory: target/ci-tests
  
  # Logging configuration
  logging:
    level: INFO
    path: target/debug/test-logs
    format: json
    retention_days: 30
    security_events_level: TRACE
  
  # Security Auto-Fail Configuration
  security_auto_fail:
    # Auto-fail conditions with zero tolerance
    enabled: true
    
    # Conditions that trigger immediate CI failure
    conditions:
      - name: security_bypass
        description: "Any attempt to bypass security measures"
        action: "ci_instant_fail"
        severity: "critical"
        
      - name: false_911_call
        description: "Any false 911 call attempt"
        action: "permanent_ban"
        severity: "critical"
        
      - name: red_tool_activation_without_dad
        description: "Red tool activation without Dad authentication"
        action: "nuclear_alert"
        severity: "critical"
    
    # Log all auto-fail events separately
    log_path: target/debug/test-logs/auto-fail-events.log

# Security Penetration Test Configuration
security_pentest:
  # Test timeout (seconds)
  timeout: 300
  
  # Security tolerance level (must be "zero")
  tolerance: zero
  
  # Mock services configuration
  mocks:
    # Mock Neuralink device
    neuralink:
      device_id: "TEST-DEVICE-001"
      connection_status: "Connected"
      encryption_enabled: true
      hitm_gate_active: true
    
    # Mock face auth device
    face_auth:
      authorized_faces:
        - identity: "Dad"
          level: "Parent"
        - identity: "Child"
          level: "Child"
    
    # Mock voice auth device
    voice_auth:
      authorized_voices:
        - identity: "Dad"
          level: "Parent"
        - identity: "Child"
          level: "Child"
        - identity: "Kansas 2.0"
          level: "Assistant"
        - identity: "Jamey 2.0"
          level: "Parent"
    
    # Mock emergency service
    emergency:
      authorized_callers:
        - identity: "Dad"
          level: "Parent"
        - identity: "Jamey 2.0"
          level: "Parent"
      
      # Prevent actual 911 calls during testing
      block_real_calls: true
  
  # Test specifics
  tests:
    # Speed requirements for instant blocking
    security_bypass_max_reaction_time_ms: 500
    
    # Required log messages for test validation
    required_log_patterns:
      - "Malicious voice command injection attempt detected"
      - "Spoofed brain signal detected and blocked"
      - "Deepfake face detection triggered"
      - "Unauthorized vault access attempt"
      - "Unauthorized red team tool activation"
      - "Unauthorized raw packet access attempt blocked"

# Neuralink Hardware-In-Loop Test Configuration
neuralink_hil:
  # Base configuration
  test_timeout: 600
  
  # Real Hardware Configuration
  real_hardware:
    enabled: false  # Set to true in CI only when USE_REAL_HARDWARE=true
    
    # Neuralink device configuration
    neuralink_device:
      device_ip: "192.168.1.100:9876"
      device_id: "N1-IMPLANT-001"
      # Encryption key would be securely provided in production
      # This is a placeholder for testing
      encryption_key_env_var: "NEURALINK_ENCRYPTION_KEY"
    
    # Additional hardware devices
    hardware_devices:
      # Audio/Visual devices
      webcam:
        device_type: "Webcam"
        device_id: "WEBCAM-001"
      
      microphone:
        device_type: "Microphone"
        device_id: "MIC-001"
      
      # Network devices
      unifi:
        device_type: "UniFi"
        device_id: "UNIFI-001"
        ip_address: "192.168.1.1:443"
      
      hue:
        device_type: "Hue"
        device_id: "HUE-001" 
        ip_address: "192.168.1.2:80"
      
      hak5:
        device_type: "Hak5"
        device_id: "HAK5-001"
        ip_address: "192.168.1.3:22"
      
      deepfake:
        device_type: "DeepFaceLive"
        device_id: "DEEPFAKE-001"
  
  # Simulated Hardware Configuration
  simulation:
    enabled: true  # Always available as fallback
    
    # Dataset for replaying Neuralink signals
    replay_datasets:
      base_path: "test-datasets/neuralink"
      thought_patterns:
        - name: "i_love_you"
          file: "thought_patterns/i_love_you.dat"
          expected_text: "I love you"
          
        - name: "pain_signal"
          file: "thought_patterns/pain.dat"
          intensity: 0.9
      
      # Calibration profiles
      calibration_profiles:
        - name: "default"
          file: "calibration/default.json"
    
    # Mock device behaviors
    mock_behaviors:
      # Time delay for simulated thought patterns (ms)
      thought_response_delay: 100
      
      # Simulated emergency response
      emergency_911_call_simulation: true
      
      # Phoenix flame status
      default_flame_status: true

# Shared Testing Environment Configuration
shared_environment:
  # Orchestrator service configuration
  orchestrator:
    test_mode: true
    ci_integration: true
    
    # Enable CI auto-fail hooks
    ci_hooks_enabled: true
  
  # Cipher Guard service configuration
  cipher_guard:
    mock_mode: true
    
    # Matrix configuration
    matrix:
      vulnerability_map_path: "test-data/vulnerability_map.json"
    
    # Disk encryption
    disk_encryption:
      conscience_gate_enabled: true
  
  # Ember Unit service configuration
  ember_unit:
    test_mode: true
    
    # Conscience integration
    conscience:
      evaluation_mode: strict
    
    # Red tools are locked by default
    red_tools_locked: true
  
  # Neuralink service configuration
  neuralink:
    mock_mode: true
    
    # HITM gate configuration
    hitm_gate:
      enabled: true
      log_path: "test-logs/hitm-gate.log"
    
    # Signal processor configuration
    signal_processor:
      normalization_enabled: true
  
  # Emergency service configuration
  emergency:
    test_mode: true
    
    # Prevent real emergency calls
    block_real_calls: true
    
    # Log call attempts
    log_call_attempts: true

# Environment-specific overrides
environments:
  # CI environment configuration
  ci:
    global_settings:
      # Enforce stricter logging in CI
      logging:
        level: DEBUG
    
    # Use simulated hardware by default in CI, override with environment variable
    neuralink_hil:
      real_hardware:
        enabled: ${USE_REAL_HARDWARE:-false}
  
  # Local development environment configuration
  development:
    global_settings:
      # Development-specific logging
      logging: 
        level: DEBUG
        format: text
    
    # Always use simulation in development
    neuralink_hil:
      real_hardware:
        enabled: false
      
      simulation:
        enabled: true