'use client';

import React, { useState } from 'react';

const vulnerabilities = [
  {
    cveId: 'CVE-2024-1234',
    description: 'Remote Code Execution in Web Server',
    cvssScore: 9.8,
    affectedSystems: ['Web Servers', 'Application Servers'],
    exploitAvailability: 'public',
    patchStatus: 'unpatched'
  },
  {
    cveId: 'CVE-2024-5678',
    description: 'SQL Injection in Database Layer',
    cvssScore: 8.5,
    affectedSystems: ['Database Servers', 'Web Applications'],
    exploitAvailability: 'private',
    patchStatus: 'partial'
  },
  {
    cveId: 'CVE-2024-9012',
    description: 'Privilege Escalation in OS',
    cvssScore: 7.2,
    affectedSystems: ['Operating Systems', 'Server Infrastructure'],
    exploitAvailability: 'none',
    patchStatus: 'fully_patched'
  },
  {
    cveId: 'CVE-2024-3456',
    description: 'Cross-Site Scripting (XSS)',
    cvssScore: 6.8,
    affectedSystems: ['Web Applications', 'Content Management Systems'],
    exploitAvailability: 'public',
    patchStatus: 'unpatched'
  }
];

const defenses = [
  {
    vulnerabilityId: 'CVE-2024-1234',
    preventiveControls: ['WAF Rules', 'Input Validation', 'Network Segmentation'],
    detectiveControls: ['IDS Signatures', 'Log Monitoring', 'Behavioral Analysis'],
    correctiveControls: ['Patch Management', 'System Hardening'],
    effectivenessScore: 75,
    coveragePercentage: 85
  },
  {
    vulnerabilityId: 'CVE-2024-5678',
    preventiveControls: ['Parameterized Queries', 'ORM Usage', 'Database Firewall'],
    detectiveControls: ['Database Monitoring', 'SQL Injection Detection'],
    correctiveControls: ['Query Optimization', 'Access Control Review'],
    effectivenessScore: 92,
    coveragePercentage: 95
  },
  {
    vulnerabilityId: 'CVE-2024-9012',
    preventiveControls: ['Privilege Management', 'User Account Control'],
    detectiveControls: ['Privilege Escalation Monitoring', 'Audit Logging'],
    correctiveControls: ['Access Revocation', 'System Rebuild'],
    effectivenessScore: 88,
    coveragePercentage: 90
  },
  {
    vulnerabilityId: 'CVE-2024-3456',
    preventiveControls: ['Content Security Policy', 'Input Sanitization'],
    detectiveControls: ['XSS Detection', 'Web Application Scanning'],
    correctiveControls: ['Code Review', 'Security Headers'],
    effectivenessScore: 82,
    coveragePercentage: 88
  }
];

const threatActors = [
  {
    name: 'Advanced Persistent Threat Group',
    motivation: 'Espionage and Data Theft',
    capabilities: ['Advanced Malware', 'Zero-Day Exploits', 'Social Engineering'],
    targets: ['Government', 'Financial', 'Technology'],
    tactics: ['Reconnaissance', 'Lateral Movement', 'Persistence']
  },
  {
    name: 'Cyber Criminal Organization',
    motivation: 'Financial Gain',
    capabilities: ['Ransomware', 'Phishing', 'Credential Theft'],
    targets: ['Healthcare', 'Retail', 'Education'],
    tactics: ['Initial Access', 'Data Exfiltration', 'Extortion']
  },
  {
    name: 'Insider Threat',
    motivation: 'Sabotage or Theft',
    capabilities: ['Legitimate Access', 'Knowledge of Systems'],
    targets: ['Internal Systems', 'Intellectual Property'],
    tactics: ['Abuse of Privileges', 'Data Manipulation']
  }
];

const attackVectors = [
  {
    name: 'Phishing Email',
    description: 'Malicious emails containing links or attachments',
    complexity: 'low',
    prerequisites: ['Email Access', 'User Interaction'],
    detectionDifficulty: 'moderate'
  },
  {
    name: 'Web Application Attack',
    description: 'Exploitation of web application vulnerabilities',
    complexity: 'medium',
    prerequisites: ['Internet Access', 'Vulnerable Application'],
    detectionDifficulty: 'difficult'
  },
  {
    name: 'Supply Chain Compromise',
    description: 'Attack through third-party software or services',
    complexity: 'high',
    prerequisites: ['Supply Chain Access', 'Trust Relationship'],
    detectionDifficulty: 'difficult'
  }
];

export default function VulnerabilityDefenseMap() {
  const [selectedTab, setSelectedTab] = useState('vulnerabilities');
  const [selectedVulnerability, setSelectedVulnerability] = useState(vulnerabilities[0]);

  const getSeverityColor = (score: number) => {
    if (score >= 9.0) return 'text-red-400';
    if (score >= 7.0) return 'text-orange-400';
    if (score >= 4.0) return 'text-yellow-400';
    return 'text-green-400';
  };

  const getEffectivenessColor = (score: number) => {
    if (score >= 90) return 'text-green-400';
    if (score >= 80) return 'text-yellow-400';
    if (score >= 70) return 'text-orange-400';
    return 'text-red-400';
  };

  const getComplexityColor = (complexity: string) => {
    switch (complexity) {
      case 'low': return 'text-green-400';
      case 'medium': return 'text-yellow-400';
      case 'high': return 'text-red-400';
      default: return 'text-gray-400';
    }
  };

  const getDetectionColor = (difficulty: string) => {
    switch (difficulty) {
      case 'easy': return 'text-green-400';
      case 'moderate': return 'text-yellow-400';
      case 'difficult': return 'text-red-400';
      default: return 'text-gray-400';
    }
  };

  const renderVulnerabilities = () => (
    <div className="space-y-4">
      {vulnerabilities.map((vuln) => (
        <div
          key={vuln.cveId}
          className={`p-4 rounded-lg cursor-pointer transition-all ${
            selectedVulnerability.cveId === vuln.cveId
              ? 'bg-blue-600 border-l-4 border-blue-400'
              : 'bg-gray-700 hover:bg-gray-600'
          }`}
          onClick={() => setSelectedVulnerability(vuln)}
        >
          <div className="flex justify-between items-start mb-2">
            <div className="font-mono font-bold text-white">{vuln.cveId}</div>
            <div className={`text-lg font-bold ${getSeverityColor(vuln.cvssScore)}`}>
              {vuln.cvssScore}
            </div>
          </div>
          <div className="text-sm text-gray-300 mb-3">{vuln.description}</div>
          <div className="flex flex-wrap gap-2 text-xs">
            <span className="bg-gray-600 px-2 py-1 rounded">{vuln.exploitAvailability}</span>
            <span className="bg-gray-600 px-2 py-1 rounded">{vuln.patchStatus}</span>
            {vuln.affectedSystems.map((system) => (
              <span key={system} className="bg-gray-600 px-2 py-1 rounded">
                {system}
              </span>
            ))}
          </div>
        </div>
      ))}
    </div>
  );

  const renderDefenses = () => (
    <div className="space-y-4">
      {defenses.map((defense) => (
        <div key={defense.vulnerabilityId} className="bg-gray-700 rounded-lg p-4">
          <div className="font-mono font-bold text-white mb-3">{defense.vulnerabilityId}</div>
          
          <div className="grid md:grid-cols-3 gap-4 mb-4">
            <div>
              <h4 className="font-medium text-blue-400 mb-2">Preventive</h4>
              <div className="space-y-1">
                {defense.preventiveControls.map((control) => (
                  <div key={control} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                    {control}
                  </div>
                ))}
              </div>
            </div>
            
            <div>
              <h4 className="font-medium text-green-400 mb-2">Detective</h4>
              <div className="space-y-1">
                {defense.detectiveControls.map((control) => (
                  <div key={control} className="text-sm text-gray-300 bg-gray-600 px-æž py-1 rounded">
                    {control}
                  </div>
                ))}
              </div>
            </div>
            
            <div>
              <h4 className="font-medium text-orange-400 mb-2">Corrective</h4>
              <div className="space-y-1">
                {defense.correctiveControls.map((control) => (
                  <div key={control} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                    {control}
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div className="flex justify-between items-center pt-2 border-t border-gray-600">
            <div>
              <span className="text-gray-300">Effectiveness: </span>
              <span className={`font-bold ${getEffectivenessColor(defense.effectivenessScore)}`}>
                {defense.effectivenessScore}%
              </span>
            </div>
            <div>
              <span className="text-gray-300">Coverage: </span>
              <span className="font-bold text-blue-400">{defense.coveragePercentage}%</span>
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  const renderThreatActors = () => (
    <div className="space-y-4">
      {threatActors.map((actor) => (
        <div key={actor.name} className="bg-gray-700 rounded-lg p-4">
          <h3 className="font-bold text-white mb-2">{actor.name}</h3>
          <div className="text-sm text-gray-300 mb-3">{actor.motivation}</div>
          
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <h4 className="font-medium text-blue-400 mb-2">Capabilities</h4>
              <div className="space-y-1">
                {actor.capabilities.map((capability) => (
                  <div key={capability} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                    {capability}
                  </div>
                ))}
              </div>
            </div>
            
            <div>
              <h4 className="font-medium text-green-400 mb-2">Tactics</h4>
              <div className="space-y-1">
                {actor.tactics.map((tactic) => (
                  <div key={tactic} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                    {tactic}
                  </div>
                ))}
              </div>
            </div>
          </div>
          
          <div className="mt-3">
            <h4 className="font-medium text-orange-400 mb-2">Targets</h4>
            <div className="flex flex-wrap gap-2">
              {actor.targets.map((target) => (
                <span key={target} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                  {target}
                </span>
              ))}
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  const renderAttackVectors = () => (
    <div className="space-y-4">
      {attackVectors.map((vector) => (
        <div key={vector.name} className="bg-gray-700 rounded-lg p-4">
          <h3 className="font-bold text-white mb-2">{vector.name}</h3>
          <div className="text-sm text-gray-300 mb-3">{vector.description}</div>
          
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <h4 className="font-medium text-blue-400 mb-2">Characteristics</h4>
              <div className="space-y-2">
                <div>
                  <span className="text-gray-300">Complexity: </span>
                  <span className={getComplexityColor(vector.complexity)}>
                    {vector.complexity}
                  </span>
                </div>
                <div>
                  <span className="text-gray-300">Detection: </span>
                  <span className={getDetectionColor(vector.detectionDifficulty)}>
                    {vector.detectionDifficulty}
                  </span>
                </div>
              </div>
            </div>
            
            <div>
              <h4 className="font-medium text-green-400 mb-2">Prerequisites</h4>
              <div className="space-y-1">
                {vector.prerequisites.map((prereq) => (
                  <div key={prereq} className="text-sm text-gray-300 bg-gray-600 px-2 py-1 rounded">
                    {prereq}
                  </div>
                ))}
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  );

  const tabs = [
    { id: 'vulnerabilities', name: 'Vulnerabilities', component: renderVulnerabilities },
    { id: 'defenses', name: 'Defenses', component: renderDefenses },
    { id: 'threats', name: 'Threat Actors', component: renderThreatActors },
    { id: 'vectors', name: 'Attack Vectors', component: renderAttackVectors }
  ];

  return (
    <div className="vulnerability-defense-map bg-gray-800 rounded-lg p-6">
      <h2 className="text-2xl font-bold text-white mb-6">Vulnerability Defense Map</h2>
      
      {/* Tab Navigation */}
      <div className="flex space-x-1 bg-gray-700 rounded-lg p-1 mb-6">
        {tabs.map((tab) => (
          <button
            key={tab.id}
            onClick={() => setSelectedTab(tab.id)}
            className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
              selectedTab === tab.id
                ? 'bg-blue-600 text-white'
                : 'text-gray-300 hover:text-white hover:bg-gray-600'
            }`}
          >
            {tab.name}
          </button>
        ))}
      </div>
      
      {/* Tab Content */}
      <div className="max-h-96 overflow-y-auto">
        {tabs.find(tab => tab.id === selectedTab)?.component()}
      </div>
    </div>
  );
}